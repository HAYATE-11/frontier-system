<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ•ãƒ­ãƒ³ãƒ†ã‚£ã‚¢åœ¨åº«ç®¡ç†ã‚¢ãƒ—ãƒª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ */
        .login-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 400px;
            margin: 100px auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .login-container h1 {
            color: #4A90E2;
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #E0E0E0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #4A90E2;
        }

        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #4A90E2 0%, #2C5AA0 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-small {
            width: auto;
            padding: 8px 16px;
            font-size: 14px;
        }

        /* ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒª */
        .app-container {
            display: none;
        }

        .app-container.active {
            display: block;
        }

        .header {
            background: linear-gradient(135deg, #4A90E2 0%, #2C5AA0 100%);
            padding: 20px 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .header h1 {
            color: white;
            font-size: 28px;
        }

        .user-info {
            color: white;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logout-btn {
            padding: 8px 20px;
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        /* ã‚¿ãƒ– */
        .tabs {
            background: white;
            border-radius: 15px;
            padding: 10px;
            margin-bottom: 30px;
            display: flex;
            gap: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .tab {
            flex: 1;
            padding: 15px;
            background: transparent;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
        }

        .tab.active {
            background: linear-gradient(135deg, #4A90E2 0%, #2C5AA0 100%);
            color: white;
        }

        .tab:hover:not(.active) {
            background: #F0F0F0;
        }

        /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ */
        .content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* åœ¨åº«è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ  */
        .add-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background: #F8F9FA;
            border-radius: 10px;
        }

        .add-form input,
        .add-form select {
            padding: 12px;
            border: 2px solid #E0E0E0;
            border-radius: 8px;
            font-size: 14px;
        }

        .add-form input:focus,
        .add-form select:focus {
            outline: none;
            border-color: #4A90E2;
        }

        .add-btn {
            grid-column: 1 / -1;
            padding: 14px;
            background: linear-gradient(135deg, #4A90E2 0%, #2C5AA0 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .add-btn:hover {
            transform: translateY(-2px);
        }

        /* æ¤œç´¢ãƒãƒ¼ */
        .search-bar {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }

        .search-bar input {
            flex: 1;
            padding: 12px;
            border: 2px solid #E0E0E0;
            border-radius: 8px;
            font-size: 14px;
        }

        .search-bar select {
            padding: 12px;
            border: 2px solid #E0E0E0;
            border-radius: 8px;
            font-size: 14px;
            min-width: 150px;
        }

        /* åœ¨åº«ã‚°ãƒªãƒƒãƒ‰ */
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .inventory-card {
            background: white;
            border: 2px solid #4A90E2;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
        }

        .inventory-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(74, 144, 226, 0.3);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            color: #2C5AA0;
        }

        .card-actions {
            display: flex;
            gap: 8px;
        }

        .card-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .edit-btn {
            background: #00A8E8;
            color: white;
        }

        .delete-btn {
            background: #FF6B6B;
            color: white;
        }

        .card-btn:hover {
            opacity: 0.8;
        }

        .card-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 15px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #E0E0E0;
        }

        .info-label {
            color: #666;
            font-size: 14px;
        }

        .info-value {
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }

        .total-price {
            background: linear-gradient(135deg, #4A90E2 0%, #2C5AA0 100%);
            color: white;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-size: 18px;
            font-weight: 700;
            margin-top: 10px;
        }

        .card-footer {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #E0E0E0;
            font-size: 12px;
            color: #999;
        }

        /* ç®¡ç†è€…ã‚¿ãƒ– */
        .admin-lock {
            text-align: center;
            padding: 60px 20px;
        }

        .admin-lock h2 {
            color: #4A90E2;
            margin-bottom: 20px;
        }

        .admin-lock input {
            padding: 12px;
            border: 2px solid #E0E0E0;
            border-radius: 8px;
            font-size: 16px;
            margin-right: 10px;
            width: 250px;
        }

        .admin-section {
            display: none;
        }

        .admin-section.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #4A90E2 0%, #2C5AA0 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        
        .section-box {
            background: #F8F9FA;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .section-box h3 {
            color: #2C5AA0;
            margin-bottom: 15px;
        }

        .ranking-list {
            background: #F8F9FA;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .ranking-list h3 {
            color: #2C5AA0;
            margin-bottom: 15px;
        }

        .ranking-item {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            background: white;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #4A90E2;
        }

        /* ã‚«ãƒ†ã‚´ãƒªãƒ¼ç®¡ç† */
        .category-management {
            background: #F8F9FA;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .category-management h3 {
            color: #2C5AA0;
            margin-bottom: 15px;
        }

        .category-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .category-tag {
            background: white;
            border: 2px solid #4A90E2;
            color: #4A90E2;
            padding: 8px 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .category-tag .remove-btn {
            background: #FF6B6B;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            font-size: 12px;
            line-height: 1;
        }

        .category-add-form {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .category-add-form input {
            flex: 1;
            padding: 10px;
            border: 2px solid #E0E0E0;
            border-radius: 8px;
            font-size: 14px;
        }

        .danger-zone {
            background: #FFF5F5;
            border: 2px solid #FF6B6B;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
        }

        .danger-zone h3 {
            color: #FF6B6B;
            margin-bottom: 15px;
        }

        .danger-btn {
            background: #FF6B6B;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin-right: 10px;
        }

        .danger-btn:hover {
            background: #FF5252;
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: #2C5AA0;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .close-btn:hover {
            color: #333;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state h3 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .inventory-grid {
                grid-template-columns: 1fr;
            }

            .add-form {
                grid-template-columns: 1fr;
            }

            .search-bar {
                flex-direction: column;
            }

            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ -->
    <div id="loginContainer" class="login-container">
        <h1>ğŸ¢ ãƒ•ãƒ­ãƒ³ãƒ†ã‚£ã‚¢åœ¨åº«ç®¡ç†</h1>
        <div class="form-group">
            <label>ãƒ¦ãƒ¼ã‚¶ãƒ¼å</label>
            <input type="text" id="usernameInput" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›">

        </div>
        <div class="form-group">
            <label>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
            <input type="password" id="passwordInput" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›">
        </div>
        <button class="btn" onclick="login()">ãƒ­ã‚°ã‚¤ãƒ³</button>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒª -->
    <div id="appContainer" class="app-container">
        <div class="container">
            <div class="header">
                <h1>ğŸ¢ ãƒ•ãƒ­ãƒ³ãƒ†ã‚£ã‚¢åœ¨åº«ç®¡ç†ã‚¢ãƒ—ãƒª</h1>
                <div class="user-info">
                    <span id="currentUser"></span>
                    <button class="logout-btn" onclick="logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
                </div>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="switchTab('inventory')">ğŸ“¦ åœ¨åº«ç®¡ç†</button>
                <button class="tab" onclick="switchTab('admin')">âš™ï¸ ç®¡ç†è€…</button>
            </div>

            <div class="content">
                <!-- åœ¨åº«ç®¡ç†ã‚¿ãƒ– -->
                <div id="inventoryTab" class="tab-content active">
                    <div class="add-form">
                        <input type="text" id="itemName" placeholder="å•†å“å *">
                        <select id="category">
                    <option value="">ã‚«ãƒ†ã‚´ãƒªãƒ¼é¸æŠ *</option>
                    <option value="__NEW__">â• æ–°ã—ã„ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’è¿½åŠ ...</option>
                        </select>
                        <input type="number" id="quantity" placeholder="æ•°é‡ *" min="0">
                        <input type="number" id="unitPrice" placeholder="å˜ä¾¡ï¼ˆä»»æ„ï¼‰" min="0">
                        <select id="manufacturer">
                    <option value="">ãƒ¡ãƒ¼ã‚«ãƒ¼ã‚’é¸æŠ</option>
                    <option value="__NEW__">â• æ–°ã—ã„ãƒ¡ãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ ...</option>
                        </select>
                        <textarea id="notes" placeholder="å‚™è€ƒï¼ˆä»»æ„ï¼‰" rows="2"></textarea>
                        <select id="location">
                            <option value="">ä¿ç®¡å ´æ‰€ã‚’é¸æŠ *</option>
                            <option value="1F">1F</option>
                            <option value="2F">2F</option>
                            <option value="2.5F">2.5F</option>
                            <option value="3F">3F</option>
                        </select>
                        <button class="add-btn" onclick="addInventory()">â• åœ¨åº«ã‚’è¿½åŠ </button>
                    </div>

                    <!-- ã‚«ãƒ†ã‚´ãƒªãƒ¼ç®¡ç† -->
                    <div class="category-section" style="background: white; padding: 20px; border-radius: 10px; margin-top: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <h3 style="color: #4A90E2; margin-bottom: 15px;">ğŸ·ï¸ ã‚«ãƒ†ã‚´ãƒªãƒ¼ç®¡ç†</h3>
                        <div class="category-list" id="categoryListInventory" style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px;">
                            <!-- ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚¿ã‚°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="newCategoryInputInventory" placeholder="æ–°ã—ã„ã‚«ãƒ†ã‚´ãƒªãƒ¼åã‚’å…¥åŠ›" style="flex: 1; padding: 10px; border: 2px solid #E0E0E0; border-radius: 8px; font-size: 14px;">
                            <button onclick="window.addCategory()" class="btn btn-small" style="width: auto; padding: 10px 20px; background: linear-gradient(135deg, #4A90E2 0%, #2C5AA0 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px;">è¿½åŠ </button>
                        </div>
                    </div>

                    <!-- ãƒ¡ãƒ¼ã‚«ãƒ¼ç®¡ç† -->
                    <div class="category-section" style="background: white; padding: 20px; border-radius: 10px; margin-top: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <h3 style="color: #4A90E2; margin-bottom: 15px;">ğŸ­ ãƒ¡ãƒ¼ã‚«ãƒ¼ç®¡ç†</h3>
                        <div class="category-list" id="manufacturerListInventory" style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px;">
                            <!-- ãƒ¡ãƒ¼ã‚«ãƒ¼ã‚¿ã‚°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="newManufacturerInputInventory" placeholder="æ–°ã—ã„ãƒ¡ãƒ¼ã‚«ãƒ¼åã‚’å…¥åŠ›" style="flex: 1; padding: 10px; border: 2px solid #E0E0E0; border-radius: 8px; font-size: 14px;">
                            <button onclick="window.addManufacturer()" class="btn btn-small" style="width: auto; padding: 10px 20px; background: linear-gradient(135deg, #4A90E2 0%, #2C5AA0 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px;">è¿½åŠ </button>
                        </div>
                    </div>

                    <div class="search-bar">
                        <input type="text" id="searchInput" placeholder="ğŸ” å•†å“åã§æ¤œç´¢" oninput="filterInventory()">
                        <select id="categoryFilter" onchange="filterInventory()">
                            <option value="">ã™ã¹ã¦ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼</option>
                        </select>
                        <select id="userFilter" onchange="filterInventory()">
                            <option value="">ã™ã¹ã¦ã®ç™»éŒ²è€…</option>
                        </select>
                    </div>

                    <div id="inventoryGrid" class="inventory-grid">
                        <!-- åœ¨åº«ã‚«ãƒ¼ãƒ‰ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                    </div>
                </div>

                <!-- ç®¡ç†è€…ã‚¿ãƒ– -->
                <div id="adminTab" class="tab-content">
                    <div id="adminLock" class="admin-lock">
                        <h2>ğŸ”’ ç®¡ç†è€…å°‚ç”¨ã‚¨ãƒªã‚¢</h2>
                        <p>ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
                        <br>
                        <input type="password" id="adminPassword" placeholder="ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
                        <button class="btn" style="width: auto; padding: 12px 30px;" onclick="unlockAdmin()">èªè¨¼</button>
                    </div>

                    <div id="adminSection" class="admin-section">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value" id="totalItems">0</div>
                                <div class="stat-label">ç·åœ¨åº«æ•°</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="totalValue">Â¥0</div>
                                <div class="stat-label">ç·åœ¨åº«é‡‘é¡</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="totalUsers">0</div>
                                <div class="stat-label">ç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°</div>
                            </div>
                        </div>

                        <!-- ã‚«ãƒ†ã‚´ãƒªãƒ¼ç®¡ç† -->
                        <div class="category-management">
                            <h3>ğŸ·ï¸ ã‚«ãƒ†ã‚´ãƒªãƒ¼ç®¡ç†</h3>
                            <div class="category-list" id="categoryList">
                                <!-- ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚¿ã‚°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                            </div>
                            <div class="category-add-form">
                                <input type="text" id="newCategoryInput" placeholder="æ–°ã—ã„ã‚«ãƒ†ã‚´ãƒªãƒ¼åã‚’å…¥åŠ›">
                                <button class="btn btn-small" onclick="addCategory()">è¿½åŠ </button>
                            </div>
                        </div>

                                                <div class="section-box">
                            <h3>ğŸ“Š ãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›</h3>
                            <button class="danger-btn" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);" onclick="exportUserReportCSV()">ğŸ“Š ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥é›†è¨ˆCSV</button>
                        </div>

                        <div class="section-box">
                            <h3>ğŸ“Š åœ¨åº«æ•°é‡ãƒ©ãƒ³ã‚­ãƒ³ã‚° TOP5</h3>
                            <div id="quantityRanking"></div>
                        </div>

                        <div class="section-box">
                            <h3>ğŸ’° åœ¨åº«é‡‘é¡ãƒ©ãƒ³ã‚­ãƒ³ã‚° TOP5</h3>
                            <div id="valueRanking"></div>
                        </div>

                        <div class="section-box">
                            <h3>ğŸ‘¤ åœ¨åº«ç™»éŒ²æ•°ãƒ©ãƒ³ã‚­ãƒ³ã‚° TOP5</h3>
                            <div id="userCountRanking"></div>
                        </div>

                        <div class="section-box">
                            <h3>ğŸ“¦ ç·åœ¨åº«æ•°ãƒ©ãƒ³ã‚­ãƒ³ã‚° TOP5ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥ï¼‰</h3>
                            <div id="userQuantityRanking"></div>
                        </div>

                        <div class="section-box">
                            <h3>ğŸ’° ç·åœ¨åº«é‡‘é¡ãƒ©ãƒ³ã‚­ãƒ³ã‚° TOP5ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥ï¼‰</h3>
                            <div id="userValueRanking"></div>
                        </div>


                        <div class="danger-zone">
                            <h3>âš ï¸ å±é™ºãªæ“ä½œ</h3>
                            <p>ä»¥ä¸‹ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚æ…é‡ã«å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚</p>
                            <br>
                            <button class="danger-btn" onclick="deleteAllInventory()">å…¨åœ¨åº«ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤</button>
                            <button class="danger-btn" onclick="showUserManagement()">ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>åœ¨åº«ã‚’ç·¨é›†</h2>
                <button class="close-btn" onclick="closeEditModal()">&times;</button>
            </div>
            <div class="form-group">
                <label>å•†å“å</label>
                <input type="text" id="editItemName">
            </div>
            <div class="form-group">
                <label>ã‚«ãƒ†ã‚´ãƒªãƒ¼</label>
                <select id="editCategory">
                </select>
            </div>
            <div class="form-group">
                <label>æ•°é‡</label>
                <input type="number" id="editQuantity" min="0">
            </div>
            <div class="form-group">
                <label>å˜ä¾¡</label>
                <input type="number" id="editUnitPrice" min="0">
                    <label>ãƒ¡ãƒ¼ã‚«ãƒ¼å</label>
                    <select id="editManufacturer">
                    <option value="">ãƒ¡ãƒ¼ã‚«ãƒ¼ã‚’é¸æŠ</option>
                    <option value="__NEW__">â• æ–°ã—ã„ãƒ¡ãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ ...</option>
                    </select>
                    <label>å‚™è€ƒï¼ˆä»»æ„ï¼‰</label>
                    <textarea id="editNotes" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label>ä¿ç®¡å ´æ‰€</label>
                <select id="editLocation">
                        <option value="">ä¿ç®¡å ´æ‰€ã‚’é¸æŠ</option>
                        <option value="1F">1F</option>
                        <option value="2F">2F</option>
                        <option value="2.5F">2.5F</option>
                        <option value="3F">3F</option>
                    </select>
            </div>
            <button class="btn" onclick="saveEdit()">ä¿å­˜</button>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInAnonymously } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc, query, orderBy, where, serverTimestamp, setDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebaseè¨­å®š
        const firebaseConfig = {
            apiKey: "AIzaSyAvL-5BFQSj7w48IvlOoNBhJGX2UlrCRU4",
            authDomain: "frontiersystem-86996.firebaseapp.com",
            projectId: "frontiersystem-86996",
            storageBucket: "frontiersystem-86996.firebasestorage.app",
            messagingSenderId: "674046328165",
            appId: "1:674046328165:web:d41b9c0a3de1e50a5e358c"
        };

        // FirebaseåˆæœŸåŒ–
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        window.db = db;
        window.auth = auth;
        window.currentUser = null;
        window.currentEditId = null;
        window.allInventory = [];
        window.allCategories = [];
        window.allManufacturers = [];


        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚«ãƒ†ã‚´ãƒªãƒ¼ï¼ˆææ¡ˆA: æ¥­å‹™ç”¨ï¼‰
        const defaultCategories = ['è³‡æ', 'å·¥å…·', 'æ¶ˆè€—å“', 'éƒ¨å“', 'æ©Ÿæ¢°ãƒ»è¨­å‚™', 'å®‰å…¨ç”¨å“', 'ãã®ä»–'];

        // åŒ¿åèªè¨¼
        signInAnonymously(auth).then(() => {
            initializeCategories();
        }).catch(error => {
            console.error('èªè¨¼ã‚¨ãƒ©ãƒ¼:', error);
        });

        // ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆæœŸåŒ–
        async function initializeCategories() {
            const categoriesRef = collection(db, 'categories');
            const snapshot = await getDocs(categoriesRef);
            
            if (snapshot.empty) {
                // åˆå›èµ·å‹•æ™‚: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’ç™»éŒ²
                for (const cat of defaultCategories) {
                    await addDoc(categoriesRef, {
                        name: cat,
                        createdAt: serverTimestamp()
                    });
                }
            }
            
            loadCategories();
        }

        // ã‚«ãƒ†ã‚´ãƒªãƒ¼èª­ã¿è¾¼ã¿
        window.loadCategories = async function() {
            const categoriesRef = collection(db, 'categories');
            const q = query(categoriesRef, orderBy('createdAt', 'asc'));
            const snapshot = await getDocs(q);
            
            window.allCategories = [];
        window.allManufacturers = [];

            snapshot.forEach(doc => {
                window.allCategories.push({
                    id: doc.id,
                    name: doc.data().name
                });
            });

            updateCategorySelects();
            updateCategoryList();
        };

        // ã‚«ãƒ†ã‚´ãƒªãƒ¼é¸æŠè‚¢ã‚’æ›´æ–°
        function updateCategorySelects() {
            const selects = [
                document.getElementById('category'),
                document.getElementById('editCategory'),
                document.getElementById('categoryFilter')
            ];

            selects.forEach((select, index) => {
                const currentValue = select.value;
                select.innerHTML = index === 2 
                    ? '<option value="">ã™ã¹ã¦ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼</option>' 
                    : '<option value="">ã‚«ãƒ†ã‚´ãƒªãƒ¼é¸æŠ *</option>';
                
                window.allCategories.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat.name;
                    option.textContent = cat.name;
                    select.appendChild(option);
                });

                select.value = currentValue;
            });
        }

        // ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒªã‚¹ãƒˆè¡¨ç¤ºï¼ˆç®¡ç†è€…ç”»é¢ï¼‰
        function updateCategoryList() {
            const list = document.getElementById('categoryList');
            if (!list) return;

            list.innerHTML = window.allCategories.map(cat => `
                <div class="category-tag">
                    <span>${cat.name}</span>
                    <button class="remove-btn" onclick="removeCategory('${cat.id}')" title="å‰Šé™¤">Ã—</button>
                </div>
            `).join('');
            // åœ¨åº«ç®¡ç†ç”»é¢ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒªã‚¹ãƒˆã‚‚æ›´æ–°
            const invList = document.getElementById('categoryListInventory');
            if (invList) {
                invList.innerHTML = window.allCategories.map(cat => `
                    <div class=\"category-tag\">
                        <span>${cat.name}</span>
                        <button class=\"remove-btn\" onclick=\"removeCategory('${cat.id}')\" title=\"å‰Šé™¤\">Ã—</button>
                    </div>
                `).join('');
            }
        }

        // ã‚«ãƒ†ã‚´ãƒªãƒ¼è¿½åŠ 
        window.addCategory = async function() {
            const input = document.getElementById('newCategoryInputInventory') || document.getElementById('newCategoryInput');
            const name = input ? input.value.trim() : '';

            if (!name) {
                alert('ã‚«ãƒ†ã‚´ãƒªãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            // é‡è¤‡ãƒã‚§ãƒƒã‚¯
            if (window.allCategories.some(cat => cat.name === name)) {
                alert('ã“ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™');
                return;
            }

            try {
                await addDoc(collection(db, 'categories'), {
                    name: name,
                    createdAt: serverTimestamp()
                });

                if (input) input.value = '';
                alert('ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’è¿½åŠ ã—ã¾ã—ãŸï¼');
                loadCategories();
            } catch (error) {
                console.error('è¿½åŠ ã‚¨ãƒ©ãƒ¼:', error);
                alert('ã‚«ãƒ†ã‚´ãƒªãƒ¼ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        };

        // ã‚«ãƒ†ã‚´ãƒªãƒ¼å‰Šé™¤
        window.removeCategory = async function(id) {
            const category = window.allCategories.find(cat => cat.id === id);
            if (!category) return;

            if (!confirm(`ã‚«ãƒ†ã‚´ãƒªãƒ¼ã€Œ${category.name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) return;

            // ã“ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹åœ¨åº«ãŒã‚ã‚‹ã‹ç¢ºèª
            const hasInventory = window.allInventory.some(item => item.category === category.name);
            if (hasInventory) {
                if (!confirm(`ã“ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹åœ¨åº«ãŒã‚ã‚Šã¾ã™ã€‚æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) return;
            }

            try {
                await deleteDoc(doc(db, 'categories', id));
                alert('ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
                loadCategories();
            } catch (error) {
                console.error('å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
                alert('ã‚«ãƒ†ã‚´ãƒªãƒ¼ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        };

        // ãƒ­ã‚°ã‚¤ãƒ³
        window.login = async function() {
            const username = document.getElementById('usernameInput').value.trim();
            const password = document.getElementById('passwordInput').value;

            if (!username) {
                alert('ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å½¢å¼ãƒã‚§ãƒƒã‚¯ï¼ˆHayate ã¯ä¾‹å¤–ï¼‰
            if (username !== 'Hayate') {
                const emailRegex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
                if (!emailRegex.test(username)) {
                    alert('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å½¢å¼ã§å…¥åŠ›ã—ã¦ãã ã•ã„\nä¾‹: tanaka@frontier.com');
                    return;
                }
            }

            if (password !== '2951') {
                alert('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“');
                return;
            }

            // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’Firestoreã«ä¿å­˜ãƒ»ç¢ºèª
            const usersRef = collection(db, 'users');
            const userQuery = query(usersRef, where('username', '==', username));
            const userSnapshot = await getDocs(userQuery);
            
            let userId = null;
            let userDoc = null;
            
            if (!userSnapshot.empty) {
                userDoc = userSnapshot.docs[0];
                userId = userDoc.id;
                const userData = userDoc.data();
                
                // ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒƒã‚¯
                if (userData.blocked === true) {
                    alert('ã“ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã¾ã™ã€‚\nç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚');
                    return;
                }
                
                // Hayate ã¯æ‰¿èªä¸è¦
                if (username !== 'Hayate') {
                    // æ‰¿èªå¾…ã¡ãƒã‚§ãƒƒã‚¯
                    if (userData.approved !== true) {
                        alert('ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ç®¡ç†è€…ã®æ‰¿èªå¾…ã¡ã§ã™ã€‚\næ‰¿èªã•ã‚Œã‚‹ã¾ã§ãŠå¾…ã¡ãã ã•ã„ã€‚');
                        return;
                    }
                }
            } else {
                // æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆHayate ã¯æ‰¿èªæ¸ˆã¿ã§ä½œæˆï¼‰
                const docRef = await addDoc(usersRef, {
                    username: username,
                    createdAt: serverTimestamp(),
                    approved: username === 'Hayate' ? true : false,
                    blocked: false
                });
                userId = docRef.id;
                
                if (username !== 'Hayate') {
                    alert('æ–°è¦ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸã€‚\nç®¡ç†è€…ã®æ‰¿èªã‚’ãŠå¾…ã¡ãã ã•ã„ã€‚');
                    return;
                }
            }

            window.currentUser = {
                id: userId,
                username: username
            };

            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('appContainer').classList.add('active');
            document.getElementById('currentUser').textContent = `ğŸ‘¤ ${username}`;

            loadCategories();
                loadInventory();
        };

        // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
        window.logout = function() {
            window.currentUser = null;
            
            // ç®¡ç†è€…ã‚¿ãƒ–ã‚’ãƒ­ãƒƒã‚¯
            document.getElementById('adminLock').style.display = 'block';
            document.getElementById('adminSection').classList.remove('active');
            document.getElementById('adminPassword').value = '';
            
            document.getElementById('loginContainer').style.display = 'block';
            document.getElementById('appContainer').classList.remove('active');
            document.getElementById('usernameInput').value = '';
            document.getElementById('passwordInput').value = '';
        };

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        window.switchTab = function(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');

            if (tabName === 'admin') {
                loadAdminData();
            }
        };

        // åœ¨åº«è¿½åŠ 
        window.addInventory = async function() {
            const itemName = document.getElementById('itemName').value.trim();
            const category = document.getElementById('category').value;
            const quantity = parseInt(document.getElementById('quantity').value);
            const unitPrice = parseInt(document.getElementById('unitPrice').value) || 0;
            const location = document.getElementById('location').value.trim();
            const manufacturer = document.getElementById('manufacturer').value;
            const notes = document.getElementById('notes').value.trim();

            if (!itemName || !category || !quantity || !location) {
                alert('ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            const totalPrice = quantity * unitPrice;

            try {
                // Hayate ã®å ´åˆã¯ç™»éŒ²è€…ã‚’ã€Œã‚·ã‚¹ãƒ†ãƒ ã€ã¨ã—ã¦è¨˜éŒ²
                const displayUsername = window.currentUser.username === 'Hayate' ? 'ã‚·ã‚¹ãƒ†ãƒ ' : window.currentUser.username;

                await addDoc(collection(db, 'inventory'), {
                    itemName,
                    category,
                    quantity,
                    unitPrice,
                    totalPrice,
                    location,
                    manufacturer,
                    notes,
                    userId: window.currentUser.id,
                    username: displayUsername,
                    createdAt: serverTimestamp(),
                    updatedAt: serverTimestamp()
                });

                // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢
                document.getElementById('itemName').value = '';
                document.getElementById('category').value = '';
                document.getElementById('quantity').value = '';
                document.getElementById('unitPrice').value = '';
                document.getElementById('location').value = '';
                document.getElementById('manufacturer').value = '';
                document.getElementById('notes').value = '';

                alert('åœ¨åº«ã‚’è¿½åŠ ã—ã¾ã—ãŸï¼');
                loadInventory();
            } catch (error) {
                console.error('è¿½åŠ ã‚¨ãƒ©ãƒ¼:', error);
                alert('åœ¨åº«ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        };

        // åœ¨åº«èª­ã¿è¾¼ã¿
        window.loadInventory = async function() {
            try {
                const inventoryRef = collection(db, 'inventory');
                const q = query(inventoryRef, orderBy('createdAt', 'desc'));
                const querySnapshot = await getDocs(q);

                window.allInventory = [];
                const users = new Set();

                querySnapshot.forEach(doc => {
                    const data = doc.data();
                    window.allInventory.push({
                        id: doc.id,
                        ...data
                    });
                    users.add(data.username);
                });

                // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ›´æ–°
                const userFilter = document.getElementById('userFilter');
                userFilter.innerHTML = '<option value="">ã™ã¹ã¦ã®ç™»éŒ²è€…</option>';
                users.forEach(user => {
                    userFilter.innerHTML += `<option value="${user}">${user}</option>`;
                });

                filterInventory();
            } catch (error) {
                console.error('èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
            }
        };

        // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
        window.filterInventory = function() {
            const searchText = document.getElementById('searchInput').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const userFilter = document.getElementById('userFilter').value;

            const filtered = window.allInventory.filter(item => {
                const matchSearch = item.itemName.toLowerCase().includes(searchText);
                const matchCategory = !categoryFilter || item.category === categoryFilter;
                const matchUser = !userFilter || item.username === userFilter;
                return matchSearch && matchCategory && matchUser;
            });

            displayInventory(filtered);
        };

        // åœ¨åº«è¡¨ç¤º
        window.displayInventory = function(items) {
            const grid = document.getElementById('inventoryGrid');
            
            if (items.length === 0) {
                grid.innerHTML = '<div class="empty-state"><h3>ğŸ“­ åœ¨åº«ãŒã‚ã‚Šã¾ã›ã‚“</h3><p>ä¸Šã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰åœ¨åº«ã‚’è¿½åŠ ã—ã¦ãã ã•ã„</p></div>';
                return;
            }

            grid.innerHTML = items.map(item => `
                <div class="inventory-card">
                    <div class="card-header">
                        <div class="card-title">${item.itemName}</div>
                        <div class="card-actions">
                            <button class="card-btn edit-btn" onclick="openEditModal('${item.id}')">ç·¨é›†</button>
                            <button class="card-btn delete-btn" onclick="deleteInventory('${item.id}')">å‰Šé™¤</button>
                        </div>
                    </div>
                    <div class="card-info">
                        <div class="info-row">
                            <span class="info-label">ã‚«ãƒ†ã‚´ãƒªãƒ¼</span>
                            <span class="info-value">${item.category}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">æ•°é‡</span>
                            <span class="info-value">${item.quantity}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">å˜ä¾¡</span>
                            <span class="info-value">Â¥${item.unitPrice.toLocaleString()}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">ä¿ç®¡å ´æ‰€</span>
                            <span class="info-value">${item.location}</span>
                        </div>
                    </div>
                    <div class="total-price">
                        åˆè¨ˆé‡‘é¡: Â¥${item.totalPrice.toLocaleString()}
                    </div>
                    <div class="card-footer">
                        ç™»éŒ²è€…: ${item.username} | ç™»éŒ²æ—¥: ${item.createdAt ? new Date(item.createdAt.seconds * 1000).toLocaleDateString() : 'ä¸æ˜'}
                    </div>
                </div>
            `).join('');
        };

        // ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
        window.openEditModal = function(id) {
            const item = window.allInventory.find(i => i.id === id);
            if (!item) return;

            window.currentEditId = id;
            document.getElementById('editItemName').value = item.itemName;
            document.getElementById('editCategory').value = item.category;
            document.getElementById('editQuantity').value = item.quantity;
            document.getElementById('editUnitPrice').value = item.unitPrice;
            document.getElementById('editLocation').value = item.location;
            document.getElementById('editManufacturer').value = item.manufacturer || '';
            document.getElementById('editNotes').value = item.notes || '';

            document.getElementById('editModal').classList.add('active');
        };

        // ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        window.closeEditModal = function() {
            document.getElementById('editModal').classList.remove('active');
            window.currentEditId = null;
        };

        // ç·¨é›†ä¿å­˜
        window.saveEdit = async function() {
            if (!window.currentEditId) return;

            const itemName = document.getElementById('editItemName').value.trim();
            const category = document.getElementById('editCategory').value;
            const quantity = parseInt(document.getElementById('editQuantity').value);
            const unitPrice = parseInt(document.getElementById('editUnitPrice').value) || 0;
            const location = document.getElementById('editLocation').value.trim();
            const manufacturer = document.getElementById('editManufacturer').value;
            const notes = document.getElementById('editNotes').value.trim();

            if (!itemName || !category || !quantity || !location) {
                alert('ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            const totalPrice = quantity * unitPrice;

            try {
                const docRef = doc(db, 'inventory', window.currentEditId);
                await updateDoc(docRef, {
                    itemName,
                    category,
                    quantity,
                    unitPrice,
                    totalPrice,
                    location,
                    manufacturer,
                    notes,
                    updatedAt: serverTimestamp()
                });

                alert('åœ¨åº«ã‚’æ›´æ–°ã—ã¾ã—ãŸï¼');
                closeEditModal();
                loadInventory();
            } catch (error) {
                console.error('æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
                alert('åœ¨åº«ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        };

        // å‰Šé™¤
        window.deleteInventory = async function(id) {
            if (!confirm('ã“ã®åœ¨åº«ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;

            try {
                await deleteDoc(doc(db, 'inventory', id));
                alert('åœ¨åº«ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
                loadInventory();
            } catch (error) {
                console.error('å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
                alert('åœ¨åº«ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        };

        // ç®¡ç†è€…èªè¨¼
        window.unlockAdmin = function() {
            const password = document.getElementById('adminPassword').value;
            if (password === 'hayate1554') {
                document.getElementById('adminLock').style.display = 'none';
                document.getElementById('adminSection').classList.add('active');
                loadAdminData();
            } else {
                alert('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“');
            }
        };

        // ç®¡ç†è€…ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        window.loadAdminData = async function() {
            if (!document.getElementById('adminSection').classList.contains('active')) return;

            try {
                // ã‚«ãƒ†ã‚´ãƒªãƒ¼èª­ã¿è¾¼ã¿
                await loadCategories();
        
        // ãƒ¡ãƒ¼ã‚«ãƒ¼ä¸€è¦§ã‚’èª­ã¿è¾¼ã¿
        window.loadManufacturers = async function() {
            const snapshot = await getDocs(collection(window.db, 'manufacturers'));
            window.allManufacturers = snapshot.docs.map(doc => ({
                id: doc.id,
                name: doc.data().name
            }));
            updateManufacturerList();
            updateManufacturerSelects();
        }
        
        // ãƒ¡ãƒ¼ã‚«ãƒ¼é¸æŠè‚¢ã‚’æ›´æ–°
        function updateManufacturerSelects() {
            const selects = ['manufacturer', 'editManufacturer'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (!select) return;
                const currentValue = select.value;
                select.innerHTML = '<option value="">ãƒ¡ãƒ¼ã‚«ãƒ¼ã‚’é¸æŠ</option>';
            select.innerHTML += '<option value=\"__NEW__\">â• æ–°ã—ã„ãƒ¡ãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ ...</option>';
                window.allManufacturers.forEach(m => {
                    const option = document.createElement('option');
                    option.value = m.name;
                    option.textContent = m.name;
                    select.appendChild(option);
                });
                select.value = currentValue;
            });
        }
        
        // ãƒ¡ãƒ¼ã‚«ãƒ¼ãƒªã‚¹ãƒˆè¡¨ç¤ºã‚’æ›´æ–°
        function updateManufacturerList() {
            const list = document.getElementById('manufacturerListInventory');
            if (!list) return;
            list.innerHTML = '';
            window.allManufacturers.forEach(m => {
                const tag = document.createElement('span');
                tag.className = 'category-tag';
                tag.innerHTML = `${m.name} <button onclick="deleteManufacturer('${m.id}')" style="background: none; border: none; color: #fff; cursor: pointer;">Ã—</button>`;
                list.appendChild(tag);
            });
        }
        
        // ãƒ¡ãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ 
        window.addManufacturer = async function() {
            const input = document.getElementById('newManufacturerInputInventory');
            const name = input.value.trim();
            if (!name) {
                alert('ãƒ¡ãƒ¼ã‚«ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            // é‡è¤‡ãƒã‚§ãƒƒã‚¯
            if (window.allManufacturers.some(m => m.name === name)) {
                alert('ã“ã®ãƒ¡ãƒ¼ã‚«ãƒ¼ã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™');
                return;
            }
            
            try {
                await addDoc(collection(window.db, 'manufacturers'), { name });
                input.value = '';
                await loadManufacturers();
                alert('ãƒ¡ãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ ã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('ãƒ¡ãƒ¼ã‚«ãƒ¼è¿½åŠ ã‚¨ãƒ©ãƒ¼:', error);
                alert('ãƒ¡ãƒ¼ã‚«ãƒ¼ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }
        
        // ãƒ¡ãƒ¼ã‚«ãƒ¼ã‚’å‰Šé™¤
        window.deleteManufacturer = async function(id) {
            if (!confirm('ã“ã®ãƒ¡ãƒ¼ã‚«ãƒ¼ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
            try {
                await deleteDoc(doc(window.db, 'manufacturers', id));
                await loadManufacturers();
                alert('ãƒ¡ãƒ¼ã‚«ãƒ¼ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('ãƒ¡ãƒ¼ã‚«ãƒ¼å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
                alert('ãƒ¡ãƒ¼ã‚«ãƒ¼ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }


                // çµ±è¨ˆãƒ‡ãƒ¼ã‚¿
                const totalItems = window.allInventory.reduce((sum, item) => sum + item.quantity, 0);
                const totalValue = window.allInventory.reduce((sum, item) => sum + item.totalPrice, 0);
                
                const usersSnapshot = await getDocs(collection(db, 'users'));
                const totalUsers = usersSnapshot.size;

                document.getElementById('totalItems').textContent = totalItems;
                document.getElementById('totalValue').textContent = 'Â¥' + totalValue.toLocaleString();
                document.getElementById('totalUsers').textContent = totalUsers;

                // æ•°é‡ãƒ©ãƒ³ã‚­ãƒ³ã‚°
                const quantityRanking = [...window.allInventory]
                    .sort((a, b) => b.quantity - a.quantity)
                    .slice(0, 5);

                document.getElementById('quantityRanking').innerHTML = quantityRanking.map((item, index) => `
                    <div class="ranking-item">
                        <span>${index + 1}. ${item.itemName}</span>
                        <span><strong>${item.quantity}</strong> å€‹</span>
                    </div>
                `).join('');

                // é‡‘é¡ãƒ©ãƒ³ã‚­ãƒ³ã‚°
                const valueRanking = [...window.allInventory]
                    .sort((a, b) => b.totalPrice - a.totalPrice)
                    .slice(0, 5);

                document.getElementById('valueRanking').innerHTML = valueRanking.map((item, index) => `
                    <div class="ranking-item">
                        <span>${index + 1}. ${item.itemName}</span>
                        <span><strong>Â¥${item.totalPrice.toLocaleString()}</strong></span>
                    </div>
                `).join('');

                // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¨ˆç®—ï¼ˆHayate ã¨ ã‚·ã‚¹ãƒ†ãƒ  ã‚’é™¤å¤–ï¼‰
                const userStats = {};
                window.allInventory.forEach(item => {
                    const user = item.username;
                    // Hayate ã¨ ã‚·ã‚¹ãƒ†ãƒ  ã‚’é™¤å¤–
                    if (user === 'Hayate' || user === 'ã‚·ã‚¹ãƒ†ãƒ ') {
                        return;
                    }
                    if (!userStats[user]) {
                        userStats[user] = {
                            count: 0,
                            quantity: 0,
                            totalValue: 0
                        };
                    }
                    userStats[user].count += 1;
                    userStats[user].quantity += item.quantity;
                    userStats[user].totalValue += item.totalPrice;
                });

                // åœ¨åº«ç™»éŒ²æ•°ãƒ©ãƒ³ã‚­ãƒ³ã‚°
                const userCountRanking = Object.entries(userStats)
                    .sort((a, b) => b[1].count - a[1].count)
                    .slice(0, 5);

                document.getElementById('userCountRanking').innerHTML = userCountRanking.map((item, index) => `
                    <div class="ranking-item">
                        <span>${index + 1}. ${item[0]}</span>
                        <span><strong>${item[1].count}</strong> ä»¶</span>
                    </div>
                `).join('');

                // ç·åœ¨åº«æ•°ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥ï¼‰
                const userQuantityRanking = Object.entries(userStats)
                    .sort((a, b) => b[1].quantity - a[1].quantity)
                    .slice(0, 5);

                document.getElementById('userQuantityRanking').innerHTML = userQuantityRanking.map((item, index) => `
                    <div class="ranking-item">
                        <span>${index + 1}. ${item[0]}</span>
                        <span><strong>${item[1].quantity}</strong> å€‹</span>
                    </div>
                `).join('');

                // ç·åœ¨åº«é‡‘é¡ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥ï¼‰
                const userValueRanking = Object.entries(userStats)
                    .sort((a, b) => b[1].totalValue - a[1].totalValue)
                    .slice(0, 5);

                document.getElementById('userValueRanking').innerHTML = userValueRanking.map((item, index) => `
                    <div class="ranking-item">
                        <span>${index + 1}. ${item[0]}</span>
                        <span><strong>Â¥${item[1].totalValue.toLocaleString()}</strong></span>
                    </div>
                `).join('');

            } catch (error) {
                console.error('ç®¡ç†è€…ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
            }
        };

        // å…¨åœ¨åº«å‰Šé™¤
        window.deleteAllInventory = async function() {
            if (!confirm('å…¨åœ¨åº«ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ï¼')) return;
            if (!confirm('æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;

            try {
                const snapshot = await getDocs(collection(db, 'inventory'));
                const deletePromises = snapshot.docs.map(doc => deleteDoc(doc.ref));
                await Promise.all(deletePromises);
                
                alert('å…¨åœ¨åº«ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
                loadInventory();
                loadAdminData();
            } catch (error) {
                console.error('å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
                alert('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        };


        // CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆé–¢æ•°
        function downloadCSV(csvContent, filename) {
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥é›†è¨ˆCSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        window.exportUserReportCSV = async function() {
            try {
                // ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥ã«é›†è¨ˆ
                const userStats = {};
                window.allInventory.forEach(item => {
                    const user = item.username;
                    if (!userStats[user]) {
                        userStats[user] = {
                            count: 0,
                            quantity: 0,
                            totalValue: 0
                        };
                    }
                    userStats[user].count += 1;
                    userStats[user].quantity += item.quantity;
                    userStats[user].totalValue += item.totalPrice;
                });

                // CSVç”Ÿæˆ
                let csv = '\uFEFFãƒ¦ãƒ¼ã‚¶ãƒ¼å,åœ¨åº«ç™»éŒ²æ•°,ç·åœ¨åº«æ•°,ç·åœ¨åº«é‡‘é¡\n';
                Object.keys(userStats).sort().forEach(user => {
                    const stats = userStats[user];
                    csv += `${user},${stats.count},${stats.quantity},${stats.totalValue}\n`;
                });

                // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                const date = new Date().toISOString().split('T')[0];
                downloadCSV(csv, `user-report-${date}.csv`);
                alert('ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥é›†è¨ˆCSVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼:', error);
                alert('CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        };

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ï¼ˆæ‰¿èªãƒ»ãƒ–ãƒ­ãƒƒã‚¯æ©Ÿèƒ½ä»˜ãï¼‰
        window.showUserManagement = async function() {
            try {
                const usersSnapshot = await getDocs(collection(db, 'users'));
                const users = [];
                usersSnapshot.forEach(doc => {
                    users.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });

                // ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
                showUserManagementModal(users);
            } catch (error) {
                console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã‚¨ãƒ©ãƒ¼:', error);
                alert('ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        };

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
        function showUserManagementModal(users) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.7);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
            `;

            const content = document.createElement('div');
            content.style.cssText = `
                background: white;
                padding: 30px;
                border-radius: 15px;
                max-width: 800px;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            `;

            let html = `
                <h2 style="margin-bottom: 20px;">ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†</h2>
                <p style="color: #666; margin-bottom: 20px;">åˆè¨ˆ: ${users.length}äºº</p>
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: #f0f0f0;">
                            <th style="padding: 10px; border: 1px solid #ddd;">ãƒ¦ãƒ¼ã‚¶ãƒ¼å</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">çŠ¶æ…‹</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            users.forEach(user => {
                const isHayate = user.username === 'Hayate';
                const isApproved = user.approved === true;
                const isBlocked = user.blocked === true;
                
                let statusText = '';
                let statusColor = '';
                
                if (isHayate) {
                    statusText = 'ğŸ‘‘ ç®¡ç†è€…';
                    statusColor = '#FFD700';
                } else if (isBlocked) {
                    statusText = 'ğŸš« ãƒ–ãƒ­ãƒƒã‚¯';
                    statusColor = '#f44336';
                } else if (isApproved) {
                    statusText = 'âœ… æ‰¿èªæ¸ˆã¿';
                    statusColor = '#4CAF50';
                } else {
                    statusText = 'â³ æ‰¿èªå¾…ã¡';
                    statusColor = '#FF9800';
                }

                html += `
                    <tr>
                        <td style="padding: 10px; border: 1px solid #ddd;">${user.username}</td>
                        <td style="padding: 10px; border: 1px solid #ddd; color: ${statusColor}; font-weight: bold;">${statusText}</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">
                `;

                if (!isHayate) {
                    if (!isApproved && !isBlocked) {
                        html += `<button onclick="approveUser('${user.id}')" style="background: #4CAF50; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; margin-right: 5px;">æ‰¿èª</button>`;
                    }
                    if (!isBlocked) {
                        html += `<button onclick="blockUser('${user.id}')" style="background: #f44336; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; margin-right: 5px;">ãƒ–ãƒ­ãƒƒã‚¯</button>`;
                    } else {
                        html += `<button onclick="unblockUser('${user.id}')" style="background: #2196F3; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; margin-right: 5px;">ãƒ–ãƒ­ãƒƒã‚¯è§£é™¤</button>`;
                    }
                } else {
                    html += `<span style="color: #999;">æ“ä½œä¸å¯</span>`;
                }

                html += `
                        </td>
                    </tr>
                `;
            });

            html += `
                    </tbody>
                </table>
                <button onclick="this.closest('[style*=fixed]').remove()" style="margin-top: 20px; padding: 10px 20px; background: #666; color: white; border: none; border-radius: 5px; cursor: pointer;">é–‰ã˜ã‚‹</button>
            `;

            content.innerHTML = html;
            modal.appendChild(content);
            document.body.appendChild(modal);

            // èƒŒæ™¯ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‰¿èª
        window.approveUser = async function(userId) {
            if (!confirm('ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ‰¿èªã—ã¾ã™ã‹ï¼Ÿ')) return;

            try {
                await updateDoc(doc(db, 'users', userId), {
                    approved: true
                });
                alert('ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ‰¿èªã—ã¾ã—ãŸ');
                showUserManagement();
            } catch (error) {
                console.error('æ‰¿èªã‚¨ãƒ©ãƒ¼:', error);
                alert('æ‰¿èªã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        };

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ–ãƒ­ãƒƒã‚¯
        window.blockUser = async function(userId) {
            if (!confirm('ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ã¾ã™ã‹ï¼Ÿ\nãƒ–ãƒ­ãƒƒã‚¯ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ­ã‚°ã‚¤ãƒ³ã§ããªããªã‚Šã¾ã™ã€‚')) return;

            try {
                await updateDoc(doc(db, 'users', userId), {
                    blocked: true
                });
                alert('ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ã¾ã—ãŸ');
                showUserManagement();
            } catch (error) {
                console.error('ãƒ–ãƒ­ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼:', error);
                alert('ãƒ–ãƒ­ãƒƒã‚¯ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        };

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ–ãƒ­ãƒƒã‚¯è§£é™¤
        window.unblockUser = async function(userId) {
            if (!confirm('ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ–ãƒ­ãƒƒã‚¯ã‚’è§£é™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;

            try {
                await updateDoc(doc(db, 'users', userId), {
                    blocked: false
                });
                alert('ãƒ–ãƒ­ãƒƒã‚¯ã‚’è§£é™¤ã—ã¾ã—ãŸ');
                showUserManagement();
            } catch (error) {
                console.error('ãƒ–ãƒ­ãƒƒã‚¯è§£é™¤ã‚¨ãƒ©ãƒ¼:', error);
                alert('ãƒ–ãƒ­ãƒƒã‚¯è§£é™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        };
    </script>
</body>
</html>